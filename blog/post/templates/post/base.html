<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <title>Blog</title>
</head>
<body>
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
        <a class="navbar-brand col-sm-3 col-md-4 mr-0" href="{% url 'view_posts' %}">My shiny blog</a>
        {% if user.is_authenticated %}
        <ul class="nav navbar-nav px-3 col-md-6">
            <li class="nav-item text-nowrap col-md-5">
                <a href="{% url 'view_create' %}" class="nav-link">Создать пост</a>
            </li>
        </ul>
        <ul class="nav navbar-nav px-3 col-md-1">
            <li class="nav-item text-nowrap col-md-4">
                <a class="nav-link" href="#" onclick="logout(); return false;">Выйти</a>
            </li>
        </ul>
        {% endif %}
    </nav>
    <div class="container-fluid">
        {% block content %}
        {% endblock %}
    </div>

    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script>
        function logout() {
            var x = new XMLHttpRequest();
            x.open('POST','/logout/', true);
            x.setRequestHeader('X-CSRFToken', getCookie('csrftoken'));
            x.onreadystatechange = function () {
                if (x.readyState !== 4)
                    return;
                if (x.status == 200)
                    alert('Пока');
                    document.location.href = '/';
            };
            x.send()
        }
        function getCookie(name) {
                 var cookieValue = null;
                 if (document.cookie && document.cookie != '') {
                     var cookies = document.cookie.split(';');
                     for (var i = 0; i < cookies.length; i++) {
                         var cookie = cookies[i].trim();
                         // Does this cookie string begin with the name we want?
                         if (cookie.substring(0, name.length + 1) == (name + '=')) {
                             cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                             break;
                         }
                     }
                 }
                 return cookieValue;
             }
    </script>
</body>
</html>